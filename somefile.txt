Newest code with Dan's expertize

Let's go and code!
